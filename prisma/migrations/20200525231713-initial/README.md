# Migration `20200525231713-initial`

This migration has been generated by praveen at 5/25/2020, 11:17:13 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."admin" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"email" text  NOT NULL ,"id" SERIAL,"is_super_admin" boolean  NOT NULL DEFAULT false,"password" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."class_session" (
"course_id" integer  NOT NULL ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"end_time" timestamp(3)  NOT NULL ,"id" SERIAL,"start_time" timestamp(3)  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."class_user" (
"class_id" integer  NOT NULL ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"rating" integer  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."course" (
"age_max" integer  NOT NULL DEFAULT 18,"age_min" integer  NOT NULL DEFAULT 3,"cover" text   ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"duration" integer  NOT NULL DEFAULT 40,"format" text  NOT NULL ,"id" SERIAL,"price" integer  NOT NULL DEFAULT 1,"size_max" integer  NOT NULL DEFAULT 20,"size_min" integer  NOT NULL DEFAULT 1,"status" text  NOT NULL DEFAULT 'unapproved',"subject_id" integer  NOT NULL ,"summary" text  NOT NULL ,"teacher_id" integer  NOT NULL ,"title" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."course_user" (
"course_id" integer  NOT NULL ,"id" SERIAL,"rating" integer  NOT NULL ,"student_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."message" (
"body" text  NOT NULL ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"sender_id" integer  NOT NULL ,"subject" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."message_recipient" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"message_id" integer  NOT NULL ,"read" boolean  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."student" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."subject" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"name" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."teacher" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."user" (
"avatar" text  NOT NULL ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"email" text  NOT NULL ,"first_name" text  NOT NULL ,"id" SERIAL,"last_name" text  NOT NULL ,"phone" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "admin.email" ON "public"."admin"("email")

CREATE UNIQUE INDEX "student.user_id" ON "public"."student"("user_id")

CREATE UNIQUE INDEX "subject.name" ON "public"."subject"("name")

CREATE UNIQUE INDEX "teacher.user_id" ON "public"."teacher"("user_id")

CREATE UNIQUE INDEX "user.email" ON "public"."user"("email")

CREATE UNIQUE INDEX "user.phone" ON "public"."user"("phone")

ALTER TABLE "public"."class_session" ADD FOREIGN KEY ("course_id")REFERENCES "public"."course"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."class_user" ADD FOREIGN KEY ("class_id")REFERENCES "public"."class_session"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."class_user" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."course" ADD FOREIGN KEY ("subject_id")REFERENCES "public"."subject"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."course" ADD FOREIGN KEY ("teacher_id")REFERENCES "public"."teacher"("user_id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."course_user" ADD FOREIGN KEY ("course_id")REFERENCES "public"."course"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."course_user" ADD FOREIGN KEY ("student_id")REFERENCES "public"."student"("user_id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."message" ADD FOREIGN KEY ("sender_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."message_recipient" ADD FOREIGN KEY ("message_id")REFERENCES "public"."message"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."message_recipient" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."student" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."teacher" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200525231713-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,135 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+model admin {
+  created_at     DateTime @default(now())
+  email          String   @unique
+  id             Int      @default(autoincrement()) @id
+  is_super_admin Boolean  @default(false)
+  password       String
+  updated_at     DateTime @default(now())
+}
+
+model class_session {
+  course_id  Int
+  created_at DateTime     @default(now())
+  end_time   DateTime
+  id         Int          @default(autoincrement()) @id
+  start_time DateTime
+  updated_at DateTime     @default(now())
+  course     course       @relation(fields: [course_id], references: [id])
+  class_user class_user[]
+}
+
+model class_user {
+  class_id      Int
+  created_at    DateTime      @default(now())
+  id            Int           @default(autoincrement()) @id
+  rating        Int
+  updated_at    DateTime      @default(now())
+  user_id       Int
+  class_session class_session @relation(fields: [class_id], references: [id])
+  user          user          @relation(fields: [user_id], references: [id])
+}
+
+model course {
+  age_max       Int             @default(18)
+  age_min       Int             @default(3)
+  cover         String?
+  created_at    DateTime        @default(now())
+  duration      Int             @default(40)
+  format        String
+  id            Int             @default(autoincrement()) @id
+  price         Int             @default(1)
+  size_max      Int             @default(20)
+  size_min      Int             @default(1)
+  status        String          @default("unapproved")
+  subject_id    Int
+  summary       String
+  teacher_id    Int
+  title         String
+  updated_at    DateTime        @default(now())
+  subject       subject         @relation(fields: [subject_id], references: [id])
+  teacher       teacher         @relation(fields: [teacher_id], references: [user_id])
+  class_session class_session[]
+  course_user   course_user[]
+}
+
+model course_user {
+  course_id  Int
+  id         Int     @default(autoincrement()) @id
+  rating     Int
+  student_id Int
+  course     course  @relation(fields: [course_id], references: [id])
+  student    student @relation(fields: [student_id], references: [user_id])
+}
+
+model message {
+  body              String
+  created_at        DateTime            @default(now())
+  id                Int                 @default(autoincrement()) @id
+  sender_id         Int
+  subject           String
+  updated_at        DateTime            @default(now())
+  user              user                @relation(fields: [sender_id], references: [id])
+  message_recipient message_recipient[]
+}
+
+model message_recipient {
+  created_at DateTime @default(now())
+  id         Int      @default(autoincrement()) @id
+  message_id Int
+  read       Boolean
+  updated_at DateTime @default(now())
+  user_id    Int
+  message    message  @relation(fields: [message_id], references: [id])
+  user       user     @relation(fields: [user_id], references: [id])
+}
+
+model student {
+  created_at  DateTime      @default(now())
+  id          Int           @default(autoincrement()) @id
+  updated_at  DateTime      @default(now())
+  user_id     Int           @unique
+  user        user          @relation(fields: [user_id], references: [id])
+  course_user course_user[]
+}
+
+model subject {
+  created_at DateTime @default(now())
+  id         Int      @default(autoincrement()) @id
+  name       String   @unique
+  updated_at DateTime @default(now())
+  course     course[]
+}
+
+model teacher {
+  created_at DateTime @default(now())
+  id         Int      @default(autoincrement()) @id
+  updated_at DateTime @default(now())
+  user_id    Int      @unique
+  user       user     @relation(fields: [user_id], references: [id])
+  course     course[]
+}
+
+model user {
+  avatar            String
+  created_at        DateTime            @default(now())
+  email             String              @unique
+  first_name        String
+  id                Int                 @default(autoincrement()) @id
+  last_name         String
+  phone             String              @unique
+  updated_at        DateTime            @default(now())
+  class_user        class_user[]
+  message           message[]
+  message_recipient message_recipient[]
+  student           student?
+  teacher           teacher?
+}
```


