# Migration `20201014132532-migration_discount_mapping_remove`

This migration has been generated by Abhinandan GP at 10/14/2020, 1:25:32 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."authentication_provider" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"data" jsonb  NOT NULL ,
"id" SERIAL,
"provider_key" text  NOT NULL ,
"provider_type" text  NOT NULL ,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."class_session" (
"course_id" integer  NOT NULL ,
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"end_time" timestamp(3)  NOT NULL ,
"id" SERIAL,
"meeting_link" text   ,
"session_link" text   DEFAULT E'',
"start_time" timestamp(3)  NOT NULL ,
"summary" text  NOT NULL ,
"topic" text  NOT NULL ,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."course" (
"academy" text   ,
"age_max" integer  NOT NULL DEFAULT 18,
"age_min" integer  NOT NULL DEFAULT 3,
"cover" text   ,
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"duration" integer  NOT NULL DEFAULT 40,
"format" text  NOT NULL ,
"hasGST" boolean  NOT NULL DEFAULT true,
"id" SERIAL,
"level" text  NOT NULL DEFAULT E'all',
"objective" text   ,
"outcampus_course_id" text   ,
"price" integer  NOT NULL DEFAULT 1,
"size_max" integer  NOT NULL DEFAULT 20,
"size_min" integer  NOT NULL DEFAULT 1,
"status" text  NOT NULL DEFAULT E'unapproved',
"subject_id" integer  NOT NULL ,
"summary" text  NOT NULL ,
"teacher_id" integer  NOT NULL ,
"title" text  NOT NULL ,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."enrolment" (
"amountPaid" integer  NOT NULL DEFAULT 0,
"course_id" integer  NOT NULL ,
"id" SERIAL,
"rating" integer   ,
"status" text  NOT NULL DEFAULT E'PENDING',
"student_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."forgot_password" (
"token" text  NOT NULL ,
"user_id" integer  NOT NULL ,
    PRIMARY KEY ("token"))

CREATE TABLE "public"."message" (
"body" text  NOT NULL ,
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"sender_id" integer  NOT NULL ,
"subject" text   ,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."message_recipient" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"message_id" integer  NOT NULL ,
"read" boolean  NOT NULL DEFAULT false,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."payout" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"payout_request" jsonb  NOT NULL ,
"payout_response" jsonb  NOT NULL ,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."profile" (
"GST" text   ,
"address" jsonb   ,
"bio" text   ,
"city" text   ,
"country" text   ,
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"dob" timestamp(3)   ,
"documents" jsonb   ,
"id" SERIAL,
"pan" text   ,
"pincode" integer   ,
"state" text   ,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."role" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"name" text  NOT NULL ,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."student_attendance" (
"class_id" integer  NOT NULL ,
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"rating" jsonb  NOT NULL ,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."subject" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"name" text  NOT NULL ,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."transaction" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"enrollment_id" integer  NOT NULL ,
"id" SERIAL,
"order_id" text  NOT NULL ,
"pg_link" text   ,
"pg_request" jsonb   ,
"pg_response" jsonb   ,
"status" text  NOT NULL DEFAULT E'PENDING',
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."user" (
"avatar" text   ,
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"dob" text   ,
"email" text   ,
"email_verification_code" text   ,
"email_verified" boolean  NOT NULL DEFAULT false,
"first_name" text   ,
"id" SERIAL,
"last_name" text   ,
"outcampus_id" text   ,
"password_hash" text   ,
"phone" text   ,
"phone_otp" integer   ,
"phone_verified" boolean  NOT NULL DEFAULT false,
"role_id" integer  NOT NULL ,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."callback_request" (
"id" SERIAL,
"phone" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."teacher_rating" (
"audio" integer  NOT NULL ,
"class_session_id" integer  NOT NULL ,
"comment" text  NOT NULL ,
"communication" integer  NOT NULL ,
"content" integer  NOT NULL ,
"course_structure" integer  NOT NULL ,
"id" SERIAL,
"overall" integer  NOT NULL ,
"professionalism" integer  NOT NULL ,
"user_id" integer  NOT NULL ,
"video" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."student_rating" (
"class_session_id" integer  NOT NULL ,
"id" SERIAL,
"participation" integer  NOT NULL ,
"performance" integer  NOT NULL ,
"remark" text  NOT NULL ,
"student_id" integer  NOT NULL ,
"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."register" (
"age_group" text   ,
"child_name" text   ,
"course_name" text   ,
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"parent_email" text   ,
"parent_name" text   ,
"phone" text   ,
"trial_date" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."teacher_email" (
"email" text   ,
"id" SERIAL,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."free_trial_date" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"date" timestamp(3)  NOT NULL ,
"id" SERIAL,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."free_trial_slot" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"free_trial_date_id" integer  NOT NULL ,
"id" SERIAL,
"startTime" text  NOT NULL ,
"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."discount_coupon" (
"code" text  NOT NULL ,
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"endTime" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"isActive" boolean  NOT NULL DEFAULT true,
"startTime" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"user_id" integer  NOT NULL DEFAULT 0,
"value" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."payment" (
"course_id" integer  NOT NULL DEFAULT 0,
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"order_id" text  NOT NULL ,
"razorpay_order_id" text  NOT NULL ,
"razorpay_payment_id" text  NOT NULL ,
"razorpay_signature" text  NOT NULL ,
"status" text  NOT NULL ,
"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "course_user_course_id_student_id_key" ON "public"."enrolment"("course_id","student_id")

CREATE UNIQUE INDEX "profile.pan" ON "public"."profile"("pan")

CREATE UNIQUE INDEX "profile.user_id" ON "public"."profile"("user_id")

CREATE UNIQUE INDEX "role.name" ON "public"."role"("name")

CREATE UNIQUE INDEX "subject.name" ON "public"."subject"("name")

CREATE UNIQUE INDEX "transaction.order_id" ON "public"."transaction"("order_id")

CREATE UNIQUE INDEX "user.email" ON "public"."user"("email")

CREATE UNIQUE INDEX "user.outcampus_id" ON "public"."user"("outcampus_id")

CREATE UNIQUE INDEX "user.phone" ON "public"."user"("phone")

CREATE UNIQUE INDEX "register.parent_email" ON "public"."register"("parent_email")

CREATE UNIQUE INDEX "register.phone" ON "public"."register"("phone")

CREATE UNIQUE INDEX "teacher_email.email" ON "public"."teacher_email"("email")

CREATE UNIQUE INDEX "discount_coupon.code" ON "public"."discount_coupon"("code")

ALTER TABLE "public"."authentication_provider" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."class_session" ADD FOREIGN KEY ("course_id")REFERENCES "public"."course"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."course" ADD FOREIGN KEY ("subject_id")REFERENCES "public"."subject"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."course" ADD FOREIGN KEY ("teacher_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."enrolment" ADD FOREIGN KEY ("course_id")REFERENCES "public"."course"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."enrolment" ADD FOREIGN KEY ("student_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."forgot_password" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."message" ADD FOREIGN KEY ("sender_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."message_recipient" ADD FOREIGN KEY ("message_id")REFERENCES "public"."message"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."message_recipient" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."profile" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."student_attendance" ADD FOREIGN KEY ("class_id")REFERENCES "public"."class_session"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."student_attendance" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."transaction" ADD FOREIGN KEY ("enrollment_id")REFERENCES "public"."enrolment"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."user" ADD FOREIGN KEY ("role_id")REFERENCES "public"."role"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."teacher_rating" ADD FOREIGN KEY ("class_session_id")REFERENCES "public"."class_session"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."teacher_rating" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."student_rating" ADD FOREIGN KEY ("student_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."student_rating" ADD FOREIGN KEY ("class_session_id")REFERENCES "public"."class_session"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."free_trial_slot" ADD FOREIGN KEY ("free_trial_date_id")REFERENCES "public"."free_trial_date"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201010093344-migration-update-enrolment..20201014132532-migration_discount_mapping_remove
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model authentication_provider {
   created_at    DateTime @default(now())
@@ -268,15 +268,15 @@
 }
 model discount_coupon {
   id Int @default(autoincrement()) @id
-  code                    String                    
+  code                    String                    @unique
   startTime               DateTime                  @default(now())
   endTime                 DateTime                  @default(now())
   created_at              DateTime                  @default(now())
   isActive                Boolean                   @default(true)
   value                   Int
-  user                    user                      @relation(fields: [id], references: [id])
+  user_id                 Int                       @default(0)
 }
 model payment {
   id Int @default(autoincrement()) @id
```


