# Migration `20200618191040-forgot-password`

This migration has been generated by praveen at 6/18/2020, 7:10:40 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."authentication_provider" DROP CONSTRAINT IF EXiSTS "authentication_providers_user_id_fkey",
ALTER COLUMN "id" DROP DEFAULT;

ALTER TABLE "public"."enrolment" ALTER COLUMN "id" DROP DEFAULT;

ALTER TABLE "public"."forgot_password" DROP CONSTRAINT IF EXiSTS "forgot_password_user_id_fkey",
DROP COLUMN "token",
ADD COLUMN "token" text  NOT NULL ;

ALTER TABLE "public"."profile" DROP CONSTRAINT IF EXiSTS "profile_user_id_fkey";

ALTER TABLE "public"."student_attendance" ALTER COLUMN "id" DROP DEFAULT;

ALTER TABLE "public"."transaction" DROP CONSTRAINT IF EXiSTS "transactions_enrollment_id_fkey",
ALTER COLUMN "id" DROP DEFAULT;

ALTER TABLE "public"."user" DROP CONSTRAINT IF EXiSTS "user_role_fkey",
DROP COLUMN "email_verification_code",
ADD COLUMN "email_verification_code" text   ;

ALTER TABLE "public"."authentication_provider" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."forgot_password" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."profile" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."transaction" ADD FOREIGN KEY ("enrollment_id")REFERENCES "public"."enrolment"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."user" ADD FOREIGN KEY ("role_id")REFERENCES "public"."role"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER INDEX "public"."profile_pan_key" RENAME TO "profile.pan"

ALTER INDEX "public"."profile_user_id_key" RENAME TO "profile.user_id"

ALTER INDEX "public"."role_name_key" RENAME TO "role.name"

ALTER INDEX "public"."transactions_order_id_key" RENAME TO "transaction.order_id"

ALTER INDEX "public"."user_outcampus_id_key" RENAME TO "user.outcampus_id"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200613154355-add-pan-and-gst..20200618191040-forgot-password
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model authentication_provider {
   created_at    DateTime @default(now())
@@ -71,8 +71,15 @@
   @@unique([course_id, student_id], name: "course_user_course_id_student_id_key")
 }
+model forgot_password {
+  id      Int    @default(autoincrement()) @id
+  token   String @default(dbgenerated())
+  user_id Int
+  user    user   @relation(fields: [user_id], references: [id])
+}
+
 model message {
   body              String
   created_at        DateTime            @default(now())
   id                Int                 @default(autoincrement()) @id
@@ -179,8 +186,9 @@
   role                    role                      @relation(fields: [role_id], references: [id])
   authentication_provider authentication_provider[]
   course                  course[]
   enrolment               enrolment[]
+  forgot_password         forgot_password[]
   message                 message[]
   message_recipient       message_recipient[]
   profile                 profile?
   student_attendance      student_attendance[]
```


