# Migration `20200613154355-add-pan-and-gst`

This migration has been generated by praveen at 6/13/2020, 3:43:55 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."authentication_provider" DROP CONSTRAINT IF EXiSTS "authentication_providers_user_id_fkey",
ALTER COLUMN "id" DROP DEFAULT;

ALTER TABLE "public"."enrolment" ALTER COLUMN "id" DROP DEFAULT;

ALTER TABLE "public"."profile" DROP CONSTRAINT IF EXiSTS "profile_user_id_fkey";

ALTER TABLE "public"."student_attendance" ALTER COLUMN "id" DROP DEFAULT;

ALTER TABLE "public"."transaction" DROP CONSTRAINT IF EXiSTS "transactions_enrollment_id_fkey",
ALTER COLUMN "id" DROP DEFAULT;

ALTER TABLE "public"."user" DROP CONSTRAINT IF EXiSTS "user_role_fkey",
DROP COLUMN "email_verification_code",
ADD COLUMN "email_verification_code" text   ;

ALTER TABLE "public"."authentication_provider" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."profile" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."transaction" ADD FOREIGN KEY ("enrollment_id")REFERENCES "public"."enrolment"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."user" ADD FOREIGN KEY ("role_id")REFERENCES "public"."role"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER INDEX "public"."profile_pan_key" RENAME TO "profile.pan"

ALTER INDEX "public"."profile_user_id_key" RENAME TO "profile.user_id"

ALTER INDEX "public"."role_name_key" RENAME TO "role.name"

ALTER INDEX "public"."transactions_order_id_key" RENAME TO "transaction.order_id"

ALTER INDEX "public"."user_outcampus_id_key" RENAME TO "user.outcampus_id"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200610090439-payment-gateway..20200613154355-add-pan-and-gst
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model authentication_provider {
   created_at    DateTime @default(now())
@@ -108,9 +108,11 @@
   city       String?
   created_at DateTime  @default(now())
   dob        DateTime?
   documents  Json?
+  GST        String?
   id         Int       @default(autoincrement()) @id
+  pan        String?   @unique
   pincode    Int?
   state      String?
   updated_at DateTime  @default(now())
   user_id    Int       @unique
```


