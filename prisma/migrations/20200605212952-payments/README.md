# Migration `20200605212952-payments`

This migration has been generated by praveen at 6/5/2020, 9:29:52 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."enrolment" ALTER COLUMN "id" DROP DEFAULT;

ALTER TABLE "public"."profile" DROP CONSTRAINT IF EXiSTS "profile_user_id_fkey";

ALTER TABLE "public"."student_attendance" ALTER COLUMN "id" DROP DEFAULT;

ALTER TABLE "public"."transactions" DROP CONSTRAINT IF EXiSTS "transactions_enrollment_id_fkey";

ALTER TABLE "public"."user" DROP CONSTRAINT IF EXiSTS "user_role_fkey",
DROP COLUMN "email_verification_code",
ADD COLUMN "email_verification_code" text   ;

ALTER TABLE "public"."profile" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."transactions" ADD FOREIGN KEY ("enrollment_id")REFERENCES "public"."enrolment"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."user" ADD FOREIGN KEY ("role_id")REFERENCES "public"."role"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER INDEX "public"."role_name_key" RENAME TO "role.name"

ALTER INDEX "public"."transactions_order_id_key" RENAME TO "transactions.order_id"

ALTER INDEX "public"."user_outcampus_id_key" RENAME TO "user.outcampus_id"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200525231713-initial..20200605212952-payments
--- datamodel.dml
+++ datamodel.dml
@@ -3,50 +3,36 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
-model admin {
-  created_at     DateTime @default(now())
-  email          String   @unique
-  id             Int      @default(autoincrement()) @id
-  is_super_admin Boolean  @default(false)
-  password       String
-  updated_at     DateTime @default(now())
-}
-
 model class_session {
-  course_id  Int
-  created_at DateTime     @default(now())
-  end_time   DateTime
-  id         Int          @default(autoincrement()) @id
-  start_time DateTime
-  updated_at DateTime     @default(now())
-  course     course       @relation(fields: [course_id], references: [id])
-  class_user class_user[]
+  course_id          Int
+  created_at         DateTime             @default(now())
+  end_time           DateTime
+  id                 Int                  @default(autoincrement()) @id
+  meeting_link       String?
+  start_time         DateTime
+  summary            String
+  topic              String
+  updated_at         DateTime             @default(now())
+  course             course               @relation(fields: [course_id], references: [id])
+  student_attendance student_attendance[]
 }
-model class_user {
-  class_id      Int
-  created_at    DateTime      @default(now())
-  id            Int           @default(autoincrement()) @id
-  rating        Int
-  updated_at    DateTime      @default(now())
-  user_id       Int
-  class_session class_session @relation(fields: [class_id], references: [id])
-  user          user          @relation(fields: [user_id], references: [id])
-}
-
 model course {
+  academy       String?
   age_max       Int             @default(18)
   age_min       Int             @default(3)
   cover         String?
   created_at    DateTime        @default(now())
   duration      Int             @default(40)
   format        String
   id            Int             @default(autoincrement()) @id
+  level         String          @default("all")
+  objective     String?
   price         Int             @default(1)
   size_max      Int             @default(20)
   size_min      Int             @default(1)
   status        String          @default("unapproved")
@@ -55,28 +41,31 @@
   teacher_id    Int
   title         String
   updated_at    DateTime        @default(now())
   subject       subject         @relation(fields: [subject_id], references: [id])
-  teacher       teacher         @relation(fields: [teacher_id], references: [user_id])
+  user          user            @relation(fields: [teacher_id], references: [id])
   class_session class_session[]
-  course_user   course_user[]
+  enrolment     enrolment[]
 }
-model course_user {
-  course_id  Int
-  id         Int     @default(autoincrement()) @id
-  rating     Int
-  student_id Int
-  course     course  @relation(fields: [course_id], references: [id])
-  student    student @relation(fields: [student_id], references: [user_id])
+model enrolment {
+  course_id    Int
+  id           Int            @default(autoincrement()) @id
+  rating       Int?
+  student_id   Int
+  course       course         @relation(fields: [course_id], references: [id])
+  user         user           @relation(fields: [student_id], references: [id])
+  transactions transactions[]
+
+  @@unique([course_id, student_id], name: "course_user_course_id_student_id_key")
 }
 model message {
   body              String
   created_at        DateTime            @default(now())
   id                Int                 @default(autoincrement()) @id
   sender_id         Int
-  subject           String
+  subject           String?
   updated_at        DateTime            @default(now())
   user              user                @relation(fields: [sender_id], references: [id])
   message_recipient message_recipient[]
 }
@@ -84,52 +73,98 @@
 model message_recipient {
   created_at DateTime @default(now())
   id         Int      @default(autoincrement()) @id
   message_id Int
-  read       Boolean
+  read       Boolean  @default(false)
   updated_at DateTime @default(now())
   user_id    Int
   message    message  @relation(fields: [message_id], references: [id])
   user       user     @relation(fields: [user_id], references: [id])
 }
-model student {
-  created_at  DateTime      @default(now())
-  id          Int           @default(autoincrement()) @id
-  updated_at  DateTime      @default(now())
-  user_id     Int           @unique
-  user        user          @relation(fields: [user_id], references: [id])
-  course_user course_user[]
+model payout {
+  created_at      DateTime @default(now())
+  id              Int      @default(autoincrement()) @id
+  payout_request  Json
+  payout_response Json
+  updated_at      DateTime @default(now())
 }
-model subject {
+model profile {
+  address    Json?
+  bio        String?
+  city       String?
+  created_at DateTime  @default(now())
+  dob        DateTime?
+  documents  Json?
+  id         Int       @default(autoincrement()) @id
+  pincode    Int?
+  state      String?
+  updated_at DateTime  @default(now())
+  user_id    Int
+  user       user      @relation(fields: [user_id], references: [id])
+}
+
+model role {
   created_at DateTime @default(now())
   id         Int      @default(autoincrement()) @id
   name       String   @unique
   updated_at DateTime @default(now())
-  course     course[]
+  user       user[]
 }
-model teacher {
+model student_attendance {
+  class_id      Int
+  created_at    DateTime      @default(now())
+  id            Int           @default(autoincrement()) @id
+  rating        Json
+  updated_at    DateTime      @default(now())
+  user_id       Int
+  class_session class_session @relation(fields: [class_id], references: [id])
+  user          user          @relation(fields: [user_id], references: [id])
+}
+
+model subject {
   created_at DateTime @default(now())
   id         Int      @default(autoincrement()) @id
+  name       String   @unique
   updated_at DateTime @default(now())
-  user_id    Int      @unique
-  user       user     @relation(fields: [user_id], references: [id])
   course     course[]
 }
+model transactions {
+  created_at    DateTime  @default(now())
+  enrollment_id Int
+  id            Int       @default(autoincrement()) @id
+  order_id      String    @unique
+  pg_request    Json
+  pg_response   Json
+  status        String
+  updated_at    DateTime  @default(now())
+  enrolment     enrolment @relation(fields: [enrollment_id], references: [id])
+}
+
 model user {
-  avatar            String
-  created_at        DateTime            @default(now())
-  email             String              @unique
-  first_name        String
-  id                Int                 @default(autoincrement()) @id
-  last_name         String
-  phone             String              @unique
-  updated_at        DateTime            @default(now())
-  class_user        class_user[]
-  message           message[]
-  message_recipient message_recipient[]
-  student           student?
-  teacher           teacher?
+  avatar                  String?
+  created_at              DateTime             @default(now())
+  dob                     String?
+  email                   String?              @unique
+  email_verification_code String?              @default(dbgenerated())
+  email_verified          Boolean              @default(false)
+  first_name              String?
+  id                      Int                  @default(autoincrement()) @id
+  last_name               String?
+  outcampus_id            String?              @unique
+  password_hash           String?
+  phone                   String?              @unique
+  phone_otp               Int?
+  phone_verified          Boolean              @default(false)
+  role_id                 Int
+  updated_at              DateTime             @default(now())
+  role                    role                 @relation(fields: [role_id], references: [id])
+  course                  course[]
+  enrolment               enrolment[]
+  message                 message[]
+  message_recipient       message_recipient[]
+  profile                 profile[]
+  student_attendance      student_attendance[]
 }
```


