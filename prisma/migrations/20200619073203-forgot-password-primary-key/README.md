# Migration `20200619073203-forgot-password-primary-key`

This migration has been generated by praveen at 6/19/2020, 7:32:03 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP TABLE "public"."authentication_provider";

DROP TABLE "public"."class_session";

DROP TABLE "public"."course";

DROP TABLE "public"."enrolment";

DROP TABLE "public"."forgot_password";

DROP TABLE "public"."message";

DROP TABLE "public"."message_recipient";

DROP TABLE "public"."payout";

DROP TABLE "public"."profile";

DROP TABLE "public"."role";

DROP TABLE "public"."student_attendance";

DROP TABLE "public"."subject";

DROP TABLE "public"."transaction";

DROP TABLE "public"."user";

CREATE TABLE "public"."authentication_provider" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"data" jsonb  NOT NULL ,"id" SERIAL,"provider_key" text  NOT NULL ,"provider_type" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."class_session" (
"course_id" integer  NOT NULL ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"end_time" timestamp(3)  NOT NULL ,"id" SERIAL,"meeting_link" text   ,"start_time" timestamp(3)  NOT NULL ,"summary" text  NOT NULL ,"topic" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."course" (
"academy" text   ,"age_max" integer  NOT NULL DEFAULT 18,"age_min" integer  NOT NULL DEFAULT 3,"cover" text   ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"duration" integer  NOT NULL DEFAULT 40,"format" text  NOT NULL ,"id" SERIAL,"level" text  NOT NULL DEFAULT E'all',"objective" text   ,"outcampus_course_id" text   ,"price" integer  NOT NULL DEFAULT 1,"size_max" integer  NOT NULL DEFAULT 20,"size_min" integer  NOT NULL DEFAULT 1,"status" text  NOT NULL DEFAULT E'unapproved',"subject_id" integer  NOT NULL ,"summary" text  NOT NULL ,"teacher_id" integer  NOT NULL ,"title" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."enrolment" (
"course_id" integer  NOT NULL ,"id" SERIAL,"rating" integer   ,"status" text  NOT NULL DEFAULT E'PENDING',"student_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."forgot_password" (
"token" text  NOT NULL ,"user_id" integer  NOT NULL ,
    PRIMARY KEY ("token"))

CREATE TABLE "public"."message" (
"body" text  NOT NULL ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"sender_id" integer  NOT NULL ,"subject" text   ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."message_recipient" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"message_id" integer  NOT NULL ,"read" boolean  NOT NULL DEFAULT false,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."payout" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"payout_request" jsonb  NOT NULL ,"payout_response" jsonb  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."profile" (
"GST" text   ,"address" jsonb   ,"bio" text   ,"city" text   ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"dob" timestamp(3)   ,"documents" jsonb   ,"id" SERIAL,"pan" text   ,"pincode" integer   ,"state" text   ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."role" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"name" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."student_attendance" (
"class_id" integer  NOT NULL ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"rating" jsonb  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"user_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."subject" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"name" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."transaction" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"enrollment_id" integer  NOT NULL ,"id" SERIAL,"order_id" text  NOT NULL ,"pg_link" text   ,"pg_request" jsonb   ,"pg_response" jsonb   ,"status" text  NOT NULL DEFAULT E'PENDING',"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."user" (
"avatar" text   ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"dob" text   ,"email" text   ,"email_verification_code" text   ,"email_verified" boolean  NOT NULL DEFAULT false,"first_name" text   ,"id" SERIAL,"last_name" text   ,"outcampus_id" text   ,"password_hash" text   ,"phone" text   ,"phone_otp" integer   ,"phone_verified" boolean  NOT NULL DEFAULT false,"role_id" integer  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "course_user_course_id_student_id_key" ON "public"."enrolment"("course_id","student_id")

CREATE UNIQUE INDEX "profile.pan" ON "public"."profile"("pan")

CREATE UNIQUE INDEX "profile.user_id" ON "public"."profile"("user_id")

CREATE UNIQUE INDEX "role.name" ON "public"."role"("name")

CREATE UNIQUE INDEX "subject.name" ON "public"."subject"("name")

CREATE UNIQUE INDEX "transaction.order_id" ON "public"."transaction"("order_id")

CREATE UNIQUE INDEX "user.email" ON "public"."user"("email")

CREATE UNIQUE INDEX "user.outcampus_id" ON "public"."user"("outcampus_id")

CREATE UNIQUE INDEX "user.phone" ON "public"."user"("phone")

ALTER TABLE "public"."authentication_provider" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."class_session" ADD FOREIGN KEY ("course_id")REFERENCES "public"."course"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."course" ADD FOREIGN KEY ("subject_id")REFERENCES "public"."subject"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."course" ADD FOREIGN KEY ("teacher_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."enrolment" ADD FOREIGN KEY ("course_id")REFERENCES "public"."course"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."enrolment" ADD FOREIGN KEY ("student_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."forgot_password" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."message" ADD FOREIGN KEY ("sender_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."message_recipient" ADD FOREIGN KEY ("message_id")REFERENCES "public"."message"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."message_recipient" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."profile" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."student_attendance" ADD FOREIGN KEY ("class_id")REFERENCES "public"."class_session"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."student_attendance" ADD FOREIGN KEY ("user_id")REFERENCES "public"."user"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."transaction" ADD FOREIGN KEY ("enrollment_id")REFERENCES "public"."enrolment"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."user" ADD FOREIGN KEY ("role_id")REFERENCES "public"."role"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200618191040-forgot-password..20200619073203-forgot-password-primary-key
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model authentication_provider {
   created_at    DateTime @default(now())
@@ -72,10 +72,9 @@
   @@unique([course_id, student_id], name: "course_user_course_id_student_id_key")
 }
 model forgot_password {
-  id      Int    @default(autoincrement()) @id
-  token   String @default(dbgenerated())
+  token   String @default(dbgenerated()) @id
   user_id Int
   user    user   @relation(fields: [user_id], references: [id])
 }
```


